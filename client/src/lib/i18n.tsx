import React, { createContext, useContext, useState, useCallback, useEffect } from "react";

export type Language = "en" | "zh" | "ms";

const translations = {
  en: {
    privateClients: "Dexter Chia Private Clients",
    appTitle: "AI Stock",
    appTitleHighlight: "Trend",
    appTitleEnd: "Terminal",
    appSubtitle: "AI-Powered Chart Pattern & Trend Analytics for the Discerning Investor.",
    appSubtitle2: "Managed by Dexter Chia, Remisier from M+ Global.",
    searchPlaceholder: "Search Symbol (e.g. KLSE:GENM)",
    analyze: "ANALYZE",
    scanner: "Scanner",
    manageUsers: "Manage Users",
    logout: "Logout",
    fetchingMarketData: "Fetching Market Data...",
    failedToLoad: "Failed to load data for",
    tryDifferentSymbol: "Try a different symbol (e.g., AAPL, MSFT, KLSE:MAYBANK)",
    noDataAvailable: "No data available",
    analyzingPatterns: "Analyzing chart patterns...",
    aiPatternAnalysis: "AI Pattern Analysis",
    aiDisclaimer: "This information is AI-generated. It does not guarantee any results and is only for your reference. For more professional advice, kindly PM Dexter.",
    requestLimitReached: "Request Limit Reached",
    limitResetNote: "Your limit will reset automatically. You can still view charts and stock data.",
    okGotIt: "OK, GOT IT",
    backToTerminal: "Back to Terminal",

    // Login
    clientLogin: "Client Login",
    admin: "Admin",
    signIn: "SIGN IN",
    adminLogin: "ADMIN LOGIN",
    email: "Email",
    password: "Password",
    adminPassword: "Admin Password",
    emailPlaceholder: "your@email.com",
    passwordPlaceholder: "Enter your password",
    adminPasswordPlaceholder: "Enter admin password",
    signInPrompt: "Please sign in to access the analysis tools",
    sessionExpiry: "Sessions expire after 15 minutes of login",
    adminAccessNote: "Admin access lets you manage allowed users",

    // Scanner
    marketScanner: "Market Scanner",
    stockScanner: "Stock",
    stockScannerHighlight: "Scanner",
    scannerSubtitle: "Scan for breakout and all-time high stocks across US and Malaysian markets.",
    market: "Market",
    usMarket: "US Market",
    malaysiaKlse: "Malaysia (KLSE)",
    scanType: "Scan Type",
    allTimeHigh: "All-Time High",
    breakout: "Breakout",
    criteriaFilters: "Criteria Filters",
    selectOneOrMore: "(select one or more)",
    breakoutConditions: "Breakout Conditions",
    technicalIndicators: "Technical Indicators",
    scan: "SCAN",
    scanning: "Scanning...",
    scanningMarket: "Scanning {market} market for {type}...",
    scanningUS: "US",
    scanningMY: "Malaysian",
    scanningATH: "all-time highs",
    scanningBreakout: "breakouts",
    scanTimeTip: "This may take 15-30 seconds",
    noStocksMatched: "No stocks matched the selected criteria right now.",
    tryDifferentFilter: "Try a different market, scan type, or adjust your filters.",
    scanPrompt: "Select your market, scan type, and criteria, then click SCAN to find stocks.",
    stocksFound: "Stocks Found",
    symbol: "Symbol",
    name: "Name",
    price: "Price",
    change: "Change",
    volume: "Volume",
    mktCap: "Mkt Cap",
    signal: "Signal",
    dataDelayed: "Data may be delayed up to 15 min",

    // Scanner criteria labels
    above5Candles: "Above last 5 candle highs",
    above10Day: "Above 10-day high",
    above3Day: "Above 3-day high",
    aboveEma5: "Above EMA 5",
    aboveEma20: "Above EMA 20",
    aboveSma200: "Above SMA 200",
    ema20AboveSma200: "EMA 20 above SMA 200",
    ema20CrossSma200: "EMA 20 cross SMA 200 (Golden Cross)",

    // Analysis Panel
    marketSentiment: "Market Sentiment",
    aiConvictionScore: "AI Conviction Score (%)",
    convictionTooltip: "Ranges from 0-100%. A higher score means the AI sees clearer patterns and feels stronger about its assessment. A lower score indicates mixed or uncertain signals.",
    aiAnalyzing: "AI Analyzing {symbol}...",
    processingPatterns: "Processing chart patterns & indicators",
    searchForAnalysis: "Search a symbol to get AI analysis",
    aiRecommendation: "AI Recommendation",
    trendLabel: "Trend",
    support: "Support",
    resistance: "Resistance",
    above: "Above",
    below: "Below",
    level: "Level",
    bullish: "Bullish",
    bearish: "Bearish",
    neutral: "Neutral",

    // Company Insights
    companyProfile: "Company Profile",
    coreBusiness: "Core Business",
    sector: "Sector",
    industry: "Industry",
    founded: "Founded",
    headquarters: "Headquarters",
    strengths: "Strengths",
    risks: "Risks",
    loadingInsights: "Loading company insights...",

    // News
    latestNews: "Latest News",
    loadingNews: "Loading news...",
    justNow: "Just now",
    hoursAgo: "{n}h ago",
    daysAgo: "{n}d ago",

    // Promotional
    privilegeService: "Dexter's Privilege Service",
    discretionaryTrading: "Discretionary Trading",
    portfolioManagement: "Portfolio Management",
    promoDescription: "I work with discretionary trading clients, managing portfolios from RM100,000 and above, with a focus on growing portfolio value while controlling downside risk. If you're looking for a more structured and professional approach to investing, feel free to message me.",
    signUpInvitationCode: "M+ Global Sign Up Invitation Code",
    referFriends: "Refer your friends/siblings/family members to get Freebies/Vouchers every month.",
    signUpLink: "M+ Global Sign Up Link",
    interestedWealth: "I'm Interested with Wealth Services",
    trustedClients: "Trusted by 2200 Clients.",
    assetsSecured: "Your Assets. Secured.",

    // Admin
    adminPanel: "Admin Panel",
    userManagement: "User Management",
    adminSubtitle: "Manage users, monitor activity, and control access.",
    addNewUser: "Add New User",
    emailAddress: "Email address",
    add: "ADD",
    allowedUsers: "Allowed Users",
    loadingUsers: "Loading users...",
    noUsersYet: "No users added yet. Add a user above to get started.",
    disabled: "Disabled",
    noLoginYet: "No login yet",
    requests: "requests",
    lastLogin: "Last login:",
    never: "Never",
    rateLimitSettings: "Rate Limit Settings",
    maxAiRequests: "Max AI requests per user per hour:",
    save: "SAVE",
    analysisLogs: "Analysis Logs",
    filterByUser: "Filter by user email...",
    from: "From",
    to: "To",
    loadingLogs: "Loading activity logs...",
    noLogsFound: "No analysis logs found.",
    user: "User",
    ip: "IP",
    date: "Date",
    topStocksAnalyzed: "Top Stocks Analyzed",
    blockedIps: "Blocked IPs (Failed Login)",
    loadingBlockedIps: "Loading blocked IPs...",
    noBlockedIps: "No blocked IPs.",
    attempts: "attempts",
    blocked: "Blocked",
    monitoring: "Monitoring",
    unblock: "Unblock",
    ipAccessRules: "IP Access Rules",
    addRule: "Add Rule",
    type: "Type",
    blockRule: "Block",
    whitelistRule: "Whitelist",
    startIp: "Start IP",
    endIp: "End IP",
    description: "Description (optional)",
    loadingIpRules: "Loading IP rules...",
    noIpRules: "No IP rules configured.",
    range: "Range",
    delete: "Delete",
    addRuleBtn: "ADD RULE",
    enableUser: "Enable user",
    disableUser: "Disable user",

    refresh: "Refresh",
    clear: "Clear",
    noLogsMatchFilters: "No logs match your filters.",
    total: "Total",
    of: "of",
    filtered: "Filtered",
    page: "Page",
    noBlockedOrFlagged: "No blocked or flagged IP addresses",
    warning: "Warning",
    failedAttempts: "Failed Attempts",
    status: "Status",
    lastAttempt: "Last Attempt",
    blockedAt: "Blocked At",
    action: "Action",
    remove: "Remove",
    ipRuleNote: "Block IP ranges or whitelist specific IPs. If any whitelist rules exist, only whitelisted IPs are allowed.",
    noIpRulesDefault: "No IP rules configured. All IPs are allowed by default.",
    created: "Created",
    na: "N/A",

    // Language
    language: "Language",
    english: "English",
    mandarin: "ä¸­æ–‡",
    malay: "Bahasa Melayu",
  },

  zh: {
    privateClients: "Dexter Chia ç§äººå®¢æˆ·",
    appTitle: "AI è‚¡ç¥¨",
    appTitleHighlight: "è¶‹åŠ¿",
    appTitleEnd: "ç»ˆç«¯",
    appSubtitle: "ä¸ºç²¾æ˜ŽæŠ•èµ„è€…æä¾›AIé©±åŠ¨çš„å›¾è¡¨æ¨¡å¼å’Œè¶‹åŠ¿åˆ†æžã€‚",
    appSubtitle2: "ç”±M+ Globalç»çºªäººDexter Chiaç®¡ç†ã€‚",
    searchPlaceholder: "æœç´¢è‚¡ç¥¨ä»£ç  (ä¾‹å¦‚ KLSE:GENM)",
    analyze: "åˆ†æž",
    scanner: "æ‰«æå™¨",
    manageUsers: "ç”¨æˆ·ç®¡ç†",
    logout: "ç™»å‡º",
    fetchingMarketData: "æ­£åœ¨èŽ·å–å¸‚åœºæ•°æ®...",
    failedToLoad: "æ— æ³•åŠ è½½æ•°æ®ï¼š",
    tryDifferentSymbol: "è¯·å°è¯•å…¶ä»–ä»£ç  (ä¾‹å¦‚ AAPL, MSFT, KLSE:MAYBANK)",
    noDataAvailable: "æš‚æ— æ•°æ®",
    analyzingPatterns: "æ­£åœ¨åˆ†æžå›¾è¡¨æ¨¡å¼...",
    aiPatternAnalysis: "AI å›¾è¡¨åˆ†æž",
    aiDisclaimer: "æ­¤ä¿¡æ¯ç”±AIç”Ÿæˆï¼Œä¸ä¿è¯ä»»ä½•ç»“æžœï¼Œä»…ä¾›å‚è€ƒã€‚å¦‚éœ€æ›´ä¸“ä¸šçš„å»ºè®®ï¼Œè¯·è”ç³»Dexterã€‚",
    requestLimitReached: "è¯·æ±‚æ¬¡æ•°å·²è¾¾ä¸Šé™",
    limitResetNote: "æ‚¨çš„é™é¢å°†è‡ªåŠ¨é‡ç½®ã€‚æ‚¨ä»ç„¶å¯ä»¥æŸ¥çœ‹å›¾è¡¨å’Œè‚¡ç¥¨æ•°æ®ã€‚",
    okGotIt: "å¥½çš„ï¼ŒçŸ¥é“äº†",
    backToTerminal: "è¿”å›žç»ˆç«¯",

    clientLogin: "å®¢æˆ·ç™»å½•",
    admin: "ç®¡ç†å‘˜",
    signIn: "ç™»å½•",
    adminLogin: "ç®¡ç†å‘˜ç™»å½•",
    email: "ç”µå­é‚®ç®±",
    password: "å¯†ç ",
    adminPassword: "ç®¡ç†å‘˜å¯†ç ",
    emailPlaceholder: "your@email.com",
    passwordPlaceholder: "è¯·è¾“å…¥å¯†ç ",
    adminPasswordPlaceholder: "è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ",
    signInPrompt: "è¯·ç™»å½•ä»¥ä½¿ç”¨åˆ†æžå·¥å…·",
    sessionExpiry: "ç™»å½•åŽ15åˆ†é’Ÿè‡ªåŠ¨è¿‡æœŸ",
    adminAccessNote: "ç®¡ç†å‘˜å¯ä»¥ç®¡ç†å…è®¸çš„ç”¨æˆ·",

    marketScanner: "å¸‚åœºæ‰«æå™¨",
    stockScanner: "è‚¡ç¥¨",
    stockScannerHighlight: "æ‰«æå™¨",
    scannerSubtitle: "æ‰«æç¾Žå›½å’Œé©¬æ¥è¥¿äºšå¸‚åœºçš„çªç ´å’ŒåŽ†å²æ–°é«˜è‚¡ç¥¨ã€‚",
    market: "å¸‚åœº",
    usMarket: "ç¾Žå›½å¸‚åœº",
    malaysiaKlse: "é©¬æ¥è¥¿äºš (KLSE)",
    scanType: "æ‰«æç±»åž‹",
    allTimeHigh: "åŽ†å²æ–°é«˜",
    breakout: "çªç ´",
    criteriaFilters: "ç­›é€‰æ¡ä»¶",
    selectOneOrMore: "ï¼ˆé€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªï¼‰",
    breakoutConditions: "çªç ´æ¡ä»¶",
    technicalIndicators: "æŠ€æœ¯æŒ‡æ ‡",
    scan: "æ‰«æ",
    scanning: "æ‰«æä¸­...",
    scanningMarket: "æ­£åœ¨æ‰«æ{market}å¸‚åœºçš„{type}...",
    scanningUS: "ç¾Žå›½",
    scanningMY: "é©¬æ¥è¥¿äºš",
    scanningATH: "åŽ†å²æ–°é«˜",
    scanningBreakout: "çªç ´",
    scanTimeTip: "å¯èƒ½éœ€è¦15-30ç§’",
    noStocksMatched: "ç›®å‰æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨ã€‚",
    tryDifferentFilter: "è¯·å°è¯•ä¸åŒçš„å¸‚åœºã€æ‰«æç±»åž‹æˆ–è°ƒæ•´ç­›é€‰æ¡ä»¶ã€‚",
    scanPrompt: "é€‰æ‹©å¸‚åœºã€æ‰«æç±»åž‹å’Œæ¡ä»¶ï¼Œç„¶åŽç‚¹å‡»æ‰«æä»¥æŸ¥æ‰¾è‚¡ç¥¨ã€‚",
    stocksFound: "åªè‚¡ç¥¨ç¬¦åˆæ¡ä»¶",
    symbol: "ä»£ç ",
    name: "åç§°",
    price: "ä»·æ ¼",
    change: "æ¶¨è·Œ",
    volume: "æˆäº¤é‡",
    mktCap: "å¸‚å€¼",
    signal: "ä¿¡å·",
    dataDelayed: "æ•°æ®å¯èƒ½å»¶è¿Ÿæœ€å¤š15åˆ†é’Ÿ",

    above5Candles: "çªç ´æœ€è¿‘5æ ¹Kçº¿é«˜ç‚¹",
    above10Day: "çªç ´10æ—¥é«˜ç‚¹",
    above3Day: "çªç ´3æ—¥é«˜ç‚¹",
    aboveEma5: "é«˜äºŽ EMA 5",
    aboveEma20: "é«˜äºŽ EMA 20",
    aboveSma200: "é«˜äºŽ SMA 200",
    ema20AboveSma200: "EMA 20 é«˜äºŽ SMA 200",
    ema20CrossSma200: "EMA 20 ç©¿è¶Š SMA 200ï¼ˆé»„é‡‘äº¤å‰ï¼‰",

    marketSentiment: "å¸‚åœºæƒ…ç»ª",
    aiConvictionScore: "AI ç¡®ä¿¡åº¦è¯„åˆ† (%)",
    convictionTooltip: "èŒƒå›´ä¸º0-100%ã€‚åˆ†æ•°è¶Šé«˜è¡¨ç¤ºAIå‘çŽ°çš„æ¨¡å¼è¶Šæ¸…æ™°ï¼Œå¯¹å…¶è¯„ä¼°è¶Šæœ‰ä¿¡å¿ƒã€‚è¾ƒä½Žçš„åˆ†æ•°è¡¨ç¤ºä¿¡å·æ··åˆæˆ–ä¸ç¡®å®šã€‚",
    aiAnalyzing: "AI æ­£åœ¨åˆ†æž {symbol}...",
    processingPatterns: "æ­£åœ¨å¤„ç†å›¾è¡¨æ¨¡å¼å’ŒæŒ‡æ ‡",
    searchForAnalysis: "æœç´¢è‚¡ç¥¨ä»£ç ä»¥èŽ·å–AIåˆ†æž",
    aiRecommendation: "AI å»ºè®®",
    trendLabel: "è¶‹åŠ¿",
    support: "æ”¯æ’‘ä½",
    resistance: "é˜»åŠ›ä½",
    above: "ä¸Šæ–¹",
    below: "ä¸‹æ–¹",
    level: "æ°´å¹³",
    bullish: "çœ‹æ¶¨",
    bearish: "çœ‹è·Œ",
    neutral: "ä¸­æ€§",

    companyProfile: "å…¬å¸ç®€ä»‹",
    coreBusiness: "æ ¸å¿ƒä¸šåŠ¡",
    sector: "è¡Œä¸šæ¿å—",
    industry: "ç»†åˆ†è¡Œä¸š",
    founded: "æˆç«‹å¹´ä»½",
    headquarters: "æ€»éƒ¨",
    strengths: "ä¼˜åŠ¿",
    risks: "é£Žé™©",
    loadingInsights: "æ­£åœ¨åŠ è½½å…¬å¸ä¿¡æ¯...",

    latestNews: "æœ€æ–°æ–°é—»",
    loadingNews: "æ­£åœ¨åŠ è½½æ–°é—»...",
    justNow: "åˆšåˆš",
    hoursAgo: "{n}å°æ—¶å‰",
    daysAgo: "{n}å¤©å‰",

    privilegeService: "Dexter ä¸“å±žæœåŠ¡",
    discretionaryTrading: "å…¨æƒå§”æ‰˜äº¤æ˜“",
    portfolioManagement: "æŠ•èµ„ç»„åˆç®¡ç†",
    promoDescription: "æˆ‘ä¸Žå…¨æƒå§”æ‰˜äº¤æ˜“å®¢æˆ·åˆä½œï¼Œç®¡ç†RM100,000åŠä»¥ä¸Šçš„æŠ•èµ„ç»„åˆï¼Œä¸“æ³¨äºŽå¢žé•¿æŠ•èµ„ç»„åˆä»·å€¼åŒæ—¶æŽ§åˆ¶ä¸‹è¡Œé£Žé™©ã€‚å¦‚æžœæ‚¨æ­£åœ¨å¯»æ‰¾æ›´æœ‰ç»“æž„å’Œä¸“ä¸šçš„æŠ•èµ„æ–¹å¼ï¼Œè¯·éšæ—¶è”ç³»æˆ‘ã€‚",
    signUpInvitationCode: "M+ Global æ³¨å†Œé‚€è¯·ç ",
    referFriends: "æŽ¨èäº²æœ‹å¥½å‹æ³¨å†Œï¼Œæ¯æœˆèŽ·å¾—å…è´¹èµ å“/ä¼˜æƒ åˆ¸ã€‚",
    signUpLink: "M+ Global æ³¨å†Œé“¾æŽ¥",
    interestedWealth: "æˆ‘å¯¹è´¢å¯ŒæœåŠ¡æ„Ÿå…´è¶£",
    trustedClients: "2200ä½å®¢æˆ·ä¿¡èµ–ã€‚",
    assetsSecured: "æ‚¨çš„èµ„äº§ï¼Œå®‰å…¨ä¿éšœã€‚",

    adminPanel: "ç®¡ç†é¢æ¿",
    userManagement: "ç”¨æˆ·ç®¡ç†",
    adminSubtitle: "ç®¡ç†ç”¨æˆ·ã€ç›‘æŽ§æ´»åŠ¨å’ŒæŽ§åˆ¶è®¿é—®ã€‚",
    addNewUser: "æ·»åŠ æ–°ç”¨æˆ·",
    emailAddress: "ç”µå­é‚®ç®±",
    add: "æ·»åŠ ",
    allowedUsers: "å…è®¸çš„ç”¨æˆ·",
    loadingUsers: "æ­£åœ¨åŠ è½½ç”¨æˆ·...",
    noUsersYet: "å°šæœªæ·»åŠ ç”¨æˆ·ã€‚åœ¨ä¸Šæ–¹æ·»åŠ ç”¨æˆ·å³å¯å¼€å§‹ã€‚",
    disabled: "å·²ç¦ç”¨",
    noLoginYet: "å°šæœªç™»å½•",
    requests: "æ¬¡è¯·æ±‚",
    lastLogin: "æœ€åŽç™»å½•ï¼š",
    never: "ä»Žæœª",
    rateLimitSettings: "é€ŸçŽ‡é™åˆ¶è®¾ç½®",
    maxAiRequests: "æ¯ç”¨æˆ·æ¯å°æ—¶æœ€å¤§AIè¯·æ±‚æ•°ï¼š",
    save: "ä¿å­˜",
    analysisLogs: "åˆ†æžæ—¥å¿—",
    filterByUser: "æŒ‰ç”¨æˆ·é‚®ç®±ç­›é€‰...",
    from: "ä»Ž",
    to: "è‡³",
    loadingLogs: "æ­£åœ¨åŠ è½½æ´»åŠ¨æ—¥å¿—...",
    noLogsFound: "æœªæ‰¾åˆ°åˆ†æžæ—¥å¿—ã€‚",
    user: "ç”¨æˆ·",
    ip: "IP",
    date: "æ—¥æœŸ",
    topStocksAnalyzed: "æœ€å¸¸åˆ†æžè‚¡ç¥¨",
    blockedIps: "è¢«å°IPï¼ˆç™»å½•å¤±è´¥ï¼‰",
    loadingBlockedIps: "æ­£åœ¨åŠ è½½è¢«å°IP...",
    noBlockedIps: "æ²¡æœ‰è¢«å°çš„IPã€‚",
    attempts: "æ¬¡å°è¯•",
    blocked: "å·²å°é”",
    monitoring: "ç›‘æŽ§ä¸­",
    unblock: "è§£å°",
    ipAccessRules: "IPè®¿é—®è§„åˆ™",
    addRule: "æ·»åŠ è§„åˆ™",
    type: "ç±»åž‹",
    blockRule: "å°é”",
    whitelistRule: "ç™½åå•",
    startIp: "èµ·å§‹IP",
    endIp: "ç»“æŸIP",
    description: "æè¿°ï¼ˆå¯é€‰ï¼‰",
    loadingIpRules: "æ­£åœ¨åŠ è½½IPè§„åˆ™...",
    noIpRules: "æœªé…ç½®IPè§„åˆ™ã€‚",
    range: "èŒƒå›´",
    delete: "åˆ é™¤",
    addRuleBtn: "æ·»åŠ è§„åˆ™",
    enableUser: "å¯ç”¨ç”¨æˆ·",
    disableUser: "ç¦ç”¨ç”¨æˆ·",

    refresh: "åˆ·æ–°",
    clear: "æ¸…é™¤",
    noLogsMatchFilters: "æ²¡æœ‰ç¬¦åˆç­›é€‰æ¡ä»¶çš„æ—¥å¿—ã€‚",
    total: "æ€»è®¡",
    of: "/",
    filtered: "å·²ç­›é€‰",
    page: "é¡µ",
    noBlockedOrFlagged: "æ²¡æœ‰è¢«å°é”æˆ–æ ‡è®°çš„IPåœ°å€",
    warning: "è­¦å‘Š",
    failedAttempts: "å¤±è´¥æ¬¡æ•°",
    status: "çŠ¶æ€",
    lastAttempt: "æœ€åŽå°è¯•",
    blockedAt: "å°é”æ—¶é—´",
    action: "æ“ä½œ",
    remove: "ç§»é™¤",
    ipRuleNote: "å°é”IPèŒƒå›´æˆ–ç™½åå•ç‰¹å®šIPã€‚å¦‚æžœå­˜åœ¨ç™½åå•è§„åˆ™ï¼Œåˆ™ä»…å…è®¸ç™½åå•ä¸­çš„IPã€‚",
    noIpRulesDefault: "æœªé…ç½®IPè§„åˆ™ã€‚é»˜è®¤å…è®¸æ‰€æœ‰IPã€‚",
    created: "åˆ›å»ºæ—¶é—´",
    na: "N/A",

    language: "è¯­è¨€",
    english: "English",
    mandarin: "ä¸­æ–‡",
    malay: "Bahasa Melayu",
  },

  ms: {
    privateClients: "Klien Peribadi Dexter Chia",
    appTitle: "AI Saham",
    appTitleHighlight: "Trend",
    appTitleEnd: "Terminal",
    appSubtitle: "Analitik Corak Carta & Trend Berkuasa AI untuk Pelabur Bijak.",
    appSubtitle2: "Diuruskan oleh Dexter Chia, Remisier dari M+ Global.",
    searchPlaceholder: "Cari Simbol (cth. KLSE:GENM)",
    analyze: "ANALISIS",
    scanner: "Pengimbas",
    manageUsers: "Urus Pengguna",
    logout: "Log Keluar",
    fetchingMarketData: "Mendapatkan Data Pasaran...",
    failedToLoad: "Gagal memuatkan data untuk",
    tryDifferentSymbol: "Cuba simbol lain (cth., AAPL, MSFT, KLSE:MAYBANK)",
    noDataAvailable: "Tiada data tersedia",
    analyzingPatterns: "Menganalisis corak carta...",
    aiPatternAnalysis: "Analisis Corak AI",
    aiDisclaimer: "Maklumat ini dijana oleh AI. Ia tidak menjamin sebarang keputusan dan hanya untuk rujukan anda. Untuk nasihat lebih profesional, sila hubungi Dexter.",
    requestLimitReached: "Had Permintaan Dicapai",
    limitResetNote: "Had anda akan ditetapkan semula secara automatik. Anda masih boleh melihat carta dan data saham.",
    okGotIt: "OK, FAHAM",
    backToTerminal: "Kembali ke Terminal",

    clientLogin: "Log Masuk Klien",
    admin: "Admin",
    signIn: "LOG MASUK",
    adminLogin: "LOG MASUK ADMIN",
    email: "E-mel",
    password: "Kata Laluan",
    adminPassword: "Kata Laluan Admin",
    emailPlaceholder: "anda@email.com",
    passwordPlaceholder: "Masukkan kata laluan anda",
    adminPasswordPlaceholder: "Masukkan kata laluan admin",
    signInPrompt: "Sila log masuk untuk menggunakan alat analisis",
    sessionExpiry: "Sesi tamat selepas 15 minit log masuk",
    adminAccessNote: "Akses admin membolehkan anda mengurus pengguna",

    marketScanner: "Pengimbas Pasaran",
    stockScanner: "Pengimbas",
    stockScannerHighlight: "Saham",
    scannerSubtitle: "Imbas saham pecah dan paras tertinggi sepanjang masa di pasaran AS dan Malaysia.",
    market: "Pasaran",
    usMarket: "Pasaran AS",
    malaysiaKlse: "Malaysia (KLSE)",
    scanType: "Jenis Imbasan",
    allTimeHigh: "Paras Tertinggi",
    breakout: "Pecah Rintangan",
    criteriaFilters: "Penapis Kriteria",
    selectOneOrMore: "(pilih satu atau lebih)",
    breakoutConditions: "Syarat Pecah",
    technicalIndicators: "Petunjuk Teknikal",
    scan: "IMBAS",
    scanning: "Mengimbas...",
    scanningMarket: "Mengimbas pasaran {market} untuk {type}...",
    scanningUS: "AS",
    scanningMY: "Malaysia",
    scanningATH: "paras tertinggi sepanjang masa",
    scanningBreakout: "pecah rintangan",
    scanTimeTip: "Ini mungkin mengambil masa 15-30 saat",
    noStocksMatched: "Tiada saham yang sepadan dengan kriteria yang dipilih sekarang.",
    tryDifferentFilter: "Cuba pasaran, jenis imbasan, atau laraskan penapis anda.",
    scanPrompt: "Pilih pasaran, jenis imbasan, dan kriteria, kemudian klik IMBAS untuk mencari saham.",
    stocksFound: "Saham Ditemui",
    symbol: "Simbol",
    name: "Nama",
    price: "Harga",
    change: "Perubahan",
    volume: "Volum",
    mktCap: "Modal Pasaran",
    signal: "Isyarat",
    dataDelayed: "Data mungkin tertangguh sehingga 15 min",

    above5Candles: "Di atas 5 lilin teratas terakhir",
    above10Day: "Di atas paras tinggi 10 hari",
    above3Day: "Di atas paras tinggi 3 hari",
    aboveEma5: "Di atas EMA 5",
    aboveEma20: "Di atas EMA 20",
    aboveSma200: "Di atas SMA 200",
    ema20AboveSma200: "EMA 20 di atas SMA 200",
    ema20CrossSma200: "EMA 20 melintas SMA 200 (Silang Emas)",

    marketSentiment: "Sentimen Pasaran",
    aiConvictionScore: "Skor Keyakinan AI (%)",
    convictionTooltip: "Julat dari 0-100%. Skor lebih tinggi bermakna AI melihat corak lebih jelas dan lebih yakin dengan penilaiannya. Skor rendah menunjukkan isyarat bercampur atau tidak pasti.",
    aiAnalyzing: "AI Menganalisis {symbol}...",
    processingPatterns: "Memproses corak carta & petunjuk",
    searchForAnalysis: "Cari simbol untuk mendapatkan analisis AI",
    aiRecommendation: "Cadangan AI",
    trendLabel: "Trend",
    support: "Sokongan",
    resistance: "Rintangan",
    above: "Di Atas",
    below: "Di Bawah",
    level: "Paras",
    bullish: "Menaik",
    bearish: "Menurun",
    neutral: "Neutral",

    companyProfile: "Profil Syarikat",
    coreBusiness: "Perniagaan Teras",
    sector: "Sektor",
    industry: "Industri",
    founded: "Ditubuhkan",
    headquarters: "Ibu Pejabat",
    strengths: "Kekuatan",
    risks: "Risiko",
    loadingInsights: "Memuatkan maklumat syarikat...",

    latestNews: "Berita Terkini",
    loadingNews: "Memuatkan berita...",
    justNow: "Baru sahaja",
    hoursAgo: "{n}j yang lalu",
    daysAgo: "{n}h yang lalu",

    privilegeService: "Perkhidmatan Istimewa Dexter",
    discretionaryTrading: "Dagangan Budi Bicara",
    portfolioManagement: "Pengurusan Portfolio",
    promoDescription: "Saya bekerja dengan klien dagangan budi bicara, menguruskan portfolio dari RM100,000 ke atas, dengan tumpuan kepada pertumbuhan nilai portfolio sambil mengawal risiko penurunan. Jika anda mencari pendekatan pelaburan yang lebih tersusun dan profesional, sila hubungi saya.",
    signUpInvitationCode: "Kod Jemputan Pendaftaran M+ Global",
    referFriends: "Rujuk rakan/adik-beradik/keluarga anda untuk mendapat Hadiah/Baucar setiap bulan.",
    signUpLink: "Pautan Pendaftaran M+ Global",
    interestedWealth: "Saya Berminat dengan Perkhidmatan Kekayaan",
    trustedClients: "Dipercayai oleh 2200 Klien.",
    assetsSecured: "Aset Anda. Terjamin.",

    adminPanel: "Panel Admin",
    userManagement: "Pengurusan Pengguna",
    adminSubtitle: "Urus pengguna, pantau aktiviti, dan kawal akses.",
    addNewUser: "Tambah Pengguna Baharu",
    emailAddress: "Alamat e-mel",
    add: "TAMBAH",
    allowedUsers: "Pengguna Dibenarkan",
    loadingUsers: "Memuatkan pengguna...",
    noUsersYet: "Tiada pengguna ditambah lagi. Tambah pengguna di atas untuk bermula.",
    disabled: "Dilumpuhkan",
    noLoginYet: "Belum log masuk",
    requests: "permintaan",
    lastLogin: "Log masuk terakhir:",
    never: "Tidak pernah",
    rateLimitSettings: "Tetapan Had Kadar",
    maxAiRequests: "Permintaan AI maksimum per pengguna sejam:",
    save: "SIMPAN",
    analysisLogs: "Log Analisis",
    filterByUser: "Tapis mengikut e-mel pengguna...",
    from: "Dari",
    to: "Hingga",
    loadingLogs: "Memuatkan log aktiviti...",
    noLogsFound: "Tiada log analisis ditemui.",
    user: "Pengguna",
    ip: "IP",
    date: "Tarikh",
    topStocksAnalyzed: "Saham Paling Kerap Dianalisis",
    blockedIps: "IP Disekat (Log Masuk Gagal)",
    loadingBlockedIps: "Memuatkan IP disekat...",
    noBlockedIps: "Tiada IP disekat.",
    attempts: "percubaan",
    blocked: "Disekat",
    monitoring: "Memantau",
    unblock: "Nyahsekat",
    ipAccessRules: "Peraturan Akses IP",
    addRule: "Tambah Peraturan",
    type: "Jenis",
    blockRule: "Sekat",
    whitelistRule: "Senarai Putih",
    startIp: "IP Mula",
    endIp: "IP Akhir",
    description: "Penerangan (pilihan)",
    loadingIpRules: "Memuatkan peraturan IP...",
    noIpRules: "Tiada peraturan IP dikonfigurasi.",
    range: "Julat",
    delete: "Padam",
    addRuleBtn: "TAMBAH PERATURAN",
    enableUser: "Aktifkan pengguna",
    disableUser: "Lumpuhkan pengguna",

    refresh: "Muat Semula",
    clear: "Kosongkan",
    noLogsMatchFilters: "Tiada log sepadan dengan penapis anda.",
    total: "Jumlah",
    of: "daripada",
    filtered: "Ditapis",
    page: "Halaman",
    noBlockedOrFlagged: "Tiada alamat IP disekat atau dibenderakan",
    warning: "Amaran",
    failedAttempts: "Percubaan Gagal",
    status: "Status",
    lastAttempt: "Percubaan Terakhir",
    blockedAt: "Disekat Pada",
    action: "Tindakan",
    remove: "Buang",
    ipRuleNote: "Sekat julat IP atau senarai putih IP tertentu. Jika terdapat peraturan senarai putih, hanya IP yang disenarai putih dibenarkan.",
    noIpRulesDefault: "Tiada peraturan IP dikonfigurasi. Semua IP dibenarkan secara lalai.",
    created: "Dicipta",
    na: "N/A",

    language: "Bahasa",
    english: "English",
    mandarin: "ä¸­æ–‡",
    malay: "Bahasa Melayu",
  },
} as const;

export type TranslationKey = keyof typeof translations.en;

interface I18nContextType {
  lang: Language;
  setLang: (lang: Language) => void;
  t: (key: TranslationKey, params?: Record<string, string>) => string;
}

const I18nContext = createContext<I18nContextType>({
  lang: "en",
  setLang: () => {},
  t: (key) => key,
});

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [lang, setLangState] = useState<Language>(() => {
    const saved = localStorage.getItem("app_language");
    return (saved as Language) || "en";
  });

  const setLang = useCallback((newLang: Language) => {
    setLangState(newLang);
    localStorage.setItem("app_language", newLang);
  }, []);

  const t = useCallback((key: TranslationKey, params?: Record<string, string>): string => {
    let text = (translations[lang] as any)[key] || (translations.en as any)[key] || key;
    if (params) {
      for (const [k, v] of Object.entries(params)) {
        text = text.replace(`{${k}}`, v);
      }
    }
    return text;
  }, [lang]);

  return (
    <I18nContext.Provider value={{ lang, setLang, t }}>
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  return useContext(I18nContext);
}

export function LanguageSwitcher({ compact }: { compact?: boolean }) {
  const { lang, setLang, t } = useI18n();

  const languages: { code: Language; label: string; flag: string }[] = [
    { code: "en", label: "EN", flag: "ðŸ‡¬ðŸ‡§" },
    { code: "zh", label: "ä¸­æ–‡", flag: "ðŸ‡¨ðŸ‡³" },
    { code: "ms", label: "BM", flag: "ðŸ‡²ðŸ‡¾" },
  ];

  return (
    <div className="flex items-center gap-1" data-testid="language-switcher">
      {languages.map(({ code, label, flag }) => (
        <button
          key={code}
          onClick={() => setLang(code)}
          className={`px-2 py-1 text-[10px] rounded transition-all cursor-pointer ${
            lang === code
              ? "bg-primary/20 text-primary border border-primary/30"
              : "text-muted-foreground hover:text-foreground border border-transparent hover:border-white/10"
          }`}
          data-testid={`button-lang-${code}`}
        >
          {compact ? label : `${flag} ${label}`}
        </button>
      ))}
    </div>
  );
}
